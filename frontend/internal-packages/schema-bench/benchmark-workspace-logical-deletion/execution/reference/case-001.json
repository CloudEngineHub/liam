{
  "tables": {
    "customers": {
      "name": "customers",
      "columns": {
        "id": {
          "name": "id",
          "type": "BIGINT",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Surrogate key; stable logical identifier"
        },
        "status": {
          "name": "status",
          "type": "VARCHAR(20)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "active|closed etc."
        },
        "created_at": {
          "name": "created_at",
          "type": "TIMESTAMP",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Creation timestamp"
        }
      },
      "comment": "Logical customer identity (no PII). Business tables reference this.",
      "indexes": {
        "ix_customers_status": {
          "name": "ix_customers_status",
          "unique": false,
          "columns": ["status"],
          "type": "BTREE"
        }
      },
      "constraints": {
        "pk_customers": {
          "type": "PRIMARY KEY",
          "name": "pk_customers",
          "columnNames": ["id"]
        }
      }
    },
    "customer_pii": {
      "name": "customer_pii",
      "columns": {
        "customer_id": {
          "name": "customer_id",
          "type": "BIGINT",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "FK to customers.id"
        },
        "name": {
          "name": "name",
          "type": "VARCHAR(100)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Full name"
        },
        "email": {
          "name": "email",
          "type": "VARCHAR(255)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Email address (unique)"
        },
        "address": {
          "name": "address",
          "type": "TEXT",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Postal address"
        },
        "phone": {
          "name": "phone",
          "type": "VARCHAR(30)",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Phone number"
        },
        "birthdate": {
          "name": "birthdate",
          "type": "DATE",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Birth date (optional)"
        }
      },
      "comment": "PII separated from logical identity. Physically deletable on erasure.",
      "indexes": {
        "ux_customer_pii_email": {
          "name": "ux_customer_pii_email",
          "unique": true,
          "columns": ["email"],
          "type": "BTREE"
        }
      },
      "constraints": {
        "pk_customer_pii": {
          "type": "PRIMARY KEY",
          "name": "pk_customer_pii",
          "columnNames": ["customer_id"]
        },
        "fk_customer_pii_customer": {
          "type": "FOREIGN KEY",
          "name": "fk_customer_pii_customer",
          "columnNames": ["customer_id"],
          "targetTableName": "customers",
          "targetColumnNames": ["id"],
          "updateConstraint": "NO_ACTION",
          "deleteConstraint": "CASCADE"
        }
      }
    },
    "orders": {
      "name": "orders",
      "columns": {
        "id": {
          "name": "id",
          "type": "BIGINT",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Order surrogate key"
        },
        "order_number": {
          "name": "order_number",
          "type": "VARCHAR(30)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Business order identifier"
        },
        "customer_id": {
          "name": "customer_id",
          "type": "BIGINT",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "FK to customers.id (not PII)"
        },
        "ordered_at": {
          "name": "ordered_at",
          "type": "TIMESTAMP",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Order timestamp"
        },
        "total_amount": {
          "name": "total_amount",
          "type": "DECIMAL(12,2)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Order total amount"
        }
      },
      "comment": "Orders reference customers (logical identity). Remains valid after PII erasure.",
      "indexes": {
        "ux_orders_order_number": {
          "name": "ux_orders_order_number",
          "unique": true,
          "columns": ["order_number"],
          "type": "BTREE"
        },
        "ix_orders_customer_id": {
          "name": "ix_orders_customer_id",
          "unique": false,
          "columns": ["customer_id"],
          "type": "BTREE"
        },
        "ix_orders_ordered_at": {
          "name": "ix_orders_ordered_at",
          "unique": false,
          "columns": ["ordered_at"],
          "type": "BTREE"
        }
      },
      "constraints": {
        "pk_orders": {
          "type": "PRIMARY KEY",
          "name": "pk_orders",
          "columnNames": ["id"]
        },
        "fk_orders_customer": {
          "type": "FOREIGN KEY",
          "name": "fk_orders_customer",
          "columnNames": ["customer_id"],
          "targetTableName": "customers",
          "targetColumnNames": ["id"],
          "updateConstraint": "NO_ACTION",
          "deleteConstraint": "RESTRICT"
        }
      }
    },
    "closure_reason_master": {
      "name": "closure_reason_master",
      "columns": {
        "reason_code": {
          "name": "reason_code",
          "type": "VARCHAR(30)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Code"
        },
        "reason_label": {
          "name": "reason_label",
          "type": "VARCHAR(100)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Display label"
        }
      },
      "comment": "Master of account closure reasons (for analytics).",
      "indexes": {},
      "constraints": {
        "pk_closure_reason_master": {
          "type": "PRIMARY KEY",
          "name": "pk_closure_reason_master",
          "columnNames": ["reason_code"]
        }
      }
    },
    "account_closure": {
      "name": "account_closure",
      "columns": {
        "customer_id": {
          "name": "customer_id",
          "type": "BIGINT",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "FK to customers"
        },
        "closed_at": {
          "name": "closed_at",
          "type": "TIMESTAMP",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Closure timestamp"
        },
        "reason_code": {
          "name": "reason_code",
          "type": "VARCHAR(30)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "FK to reason master"
        },
        "detail_note": {
          "name": "detail_note",
          "type": "TEXT",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Optional free text (should avoid PII)"
        }
      },
      "comment": "Account closure fact table for analysis.",
      "indexes": {
        "ix_account_closure_closed_at": {
          "name": "ix_account_closure_closed_at",
          "unique": false,
          "columns": ["closed_at"],
          "type": "BTREE"
        }
      },
      "constraints": {
        "pk_account_closure": {
          "type": "PRIMARY KEY",
          "name": "pk_account_closure",
          "columnNames": ["customer_id"]
        },
        "fk_account_closure_customer": {
          "type": "FOREIGN KEY",
          "name": "fk_account_closure_customer",
          "columnNames": ["customer_id"],
          "targetTableName": "customers",
          "targetColumnNames": ["id"],
          "updateConstraint": "NO_ACTION",
          "deleteConstraint": "RESTRICT"
        },
        "fk_account_closure_reason": {
          "type": "FOREIGN KEY",
          "name": "fk_account_closure_reason",
          "columnNames": ["reason_code"],
          "targetTableName": "closure_reason_master",
          "targetColumnNames": ["reason_code"],
          "updateConstraint": "NO_ACTION",
          "deleteConstraint": "RESTRICT"
        }
      }
    },

    "data_erasure_request": {
      "name": "data_erasure_request",
      "columns": {
        "request_id": {
          "name": "request_id",
          "type": "BIGINT",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Request identifier"
        },
        "customer_id": {
          "name": "customer_id",
          "type": "BIGINT",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "FK to customers"
        },
        "requested_at": {
          "name": "requested_at",
          "type": "TIMESTAMP",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Requested time"
        },
        "status": {
          "name": "status",
          "type": "VARCHAR(20)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "pending|processed|rejected"
        },
        "processed_at": {
          "name": "processed_at",
          "type": "TIMESTAMP",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Processed time"
        },
        "legal_hold": {
          "name": "legal_hold",
          "type": "BOOLEAN",
          "default": false,
          "check": null,
          "notNull": true,
          "comment": "True if legal reason blocks erasure"
        }
      },
      "comment": "Tracks GDPR/erasure workflows separate from business data.",
      "indexes": {
        "ix_erasure_customer": {
          "name": "ix_erasure_customer",
          "unique": false,
          "columns": ["customer_id"],
          "type": "BTREE"
        }
      },
      "constraints": {
        "pk_data_erasure_request": {
          "type": "PRIMARY KEY",
          "name": "pk_data_erasure_request",
          "columnNames": ["request_id"]
        },
        "fk_erasure_customer": {
          "type": "FOREIGN KEY",
          "name": "fk_erasure_customer",
          "columnNames": ["customer_id"],
          "targetTableName": "customers",
          "targetColumnNames": ["id"],
          "updateConstraint": "NO_ACTION",
          "deleteConstraint": "RESTRICT"
        }
      }
    },
    "audit_log": {
      "name": "audit_log",
      "columns": {
        "id": {
          "name": "id",
          "type": "BIGINT",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Event id"
        },
        "customer_id": {
          "name": "customer_id",
          "type": "BIGINT",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Nullable FK to customers"
        },
        "action": {
          "name": "action",
          "type": "VARCHAR(50)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "e.g. PII_ERASED, ACCOUNT_CLOSED"
        },
        "occurred_at": {
          "name": "occurred_at",
          "type": "TIMESTAMP",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "When the action occurred"
        },
        "actor": {
          "name": "actor",
          "type": "VARCHAR(100)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "System or user who performed the action"
        },
        "detail": {
          "name": "detail",
          "type": "TEXT",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Additional context without PII"
        }
      },
      "comment": "Append-only audit trail. Keep even if customer is gone.",
      "indexes": {
        "ix_audit_customer": {
          "name": "ix_audit_customer",
          "unique": false,
          "columns": ["customer_id"],
          "type": "BTREE"
        },
        "ix_audit_occurred_at": {
          "name": "ix_audit_occurred_at",
          "unique": false,
          "columns": ["occurred_at"],
          "type": "BTREE"
        }
      },
      "constraints": {
        "pk_audit_log": {
          "type": "PRIMARY KEY",
          "name": "pk_audit_log",
          "columnNames": ["id"]
        },
        "fk_audit_customer": {
          "type": "FOREIGN KEY",
          "name": "fk_audit_customer",
          "columnNames": ["customer_id"],
          "targetTableName": "customers",
          "targetColumnNames": ["id"],
          "updateConstraint": "NO_ACTION",
          "deleteConstraint": "SET_NULL"
        }
      }
    }
  },
  "enums": {},
  "extensions": {}
}
